#import autosub
#import time
#import cgi
#import urllib
#import re
#from types import *
#from autosub.Db import lastDown
#from autosub.Helpers import ConvertTimestamp, ConvertTimestampTable
#from autosub.Helpers import getAttr

#include $os.path.join($autosub.PATH.encode(), "interface/templates/header.tmpl")

$autosub.WANTEDQUEUE.sort(key=$getAttr('title'))

        <div class="page-header"><h1>Home</h1></div>

<div class="overview">
#if $autosub.HOMELAYOUTFIRST == "Downloaded":
	<div id="Display2">
#else
	<div id="Display1">
#end if
		<div class="well well-small center well-header"><b>Wanted</b></div>
#if not $autosub.DOWNLOADDUTCH and not $autosub.DOWNLOADENG:
		<div class="alert alert-error center"><i class="icon-info-sign"></i> <strong>Oh snap!</strong> You currently have Dutch and English disabled, you don't want to use me anymore? :( <i class="icon-info-sign"></i></div>
#else		
		<div class="well well-small center">
#if $len($autosub.WANTEDQUEUE) == 0
		No data available at the moment.
#end if		
#if $len($autosub.WANTEDQUEUE) >= 1
		<table id="wanted">
			<thead>
				<tr>
					<th>Show name</th>
					<th>Season</th>
					<th>Episode</th>
					<th>Source</th>
					<th>Quality</th>
					<th>Codec</th>
					<th>Group</th>
					<th>Language</th>
					<th>Time</th>
					<th>&nbsp;</th>
				</tr>
			</thead>
		<tbody>
#for $var in $autosub.WANTEDQUEUE

#set $title_escaped = $cgi.escape($var['title'], True)
		<tr>
			<td align="left"><a data-placement="right" data-toggle="tooltip" data-original-title="$var['originalFileLocationOnDisk']">$var['title']</a></td>
			<td>$var['season']</td>
			<td>$var['episode']</td>
#if $type($var['source']) == UnicodeType:
			<td>$var['source'].upper()</td>
#else
			<td>Unknown</td>
#end if
#if $type($var['quality']) == UnicodeType:
			<td>$var['quality'].upper()</td>
#else
			<td>Unknown</td>
#end if
#if $type($var['codec']) == UnicodeType:
			<td>$var['codec'].upper()</td>
#else
			<td>Unknown</td>
#end if
#if $type($var['releasegrp']) == UnicodeType:
			<td>$var['releasegrp'].upper()</td>
#else
			<td>Unknown</td>
#end if
			<td>
#for lang in $var['lang']
#if lang == "Dutch"
			<img src="$autosub.WEBROOT/images/Dutch.png" alt="nl">
#end if
#if lang == "English"
			<img src="$autosub.WEBROOT/images/English.png" alt="en">
#end if
#end for
			</td>
#if $type($var['timestamp']) == UnicodeType:
			<td sorttable_customkey="$ConvertTimestampTable($var['timestamp'])">$ConvertTimestamp($var['timestamp'])</td>
#else
			<td>Unknown</td>
#end if	
			<td>
			
			  <div class="nav-collapse skipshow">
				  <ul class="nav">
					<li class="dropdown">
					  <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-wrench"></i></a>
					  <ul class="dropdown-menu">
						<li><a href="$autosub.WEBROOT/config/skipShow/$var['title'].replace(' ', '%20')/0">Skip $var['title']</a></li>
						<li><a href="$autosub.WEBROOT/config/skipShow/$var['title'].replace(' ', '%20')/$var['season']">Skip $var['title'] S$var['season']</a></li>
					  </ul>
					</li>
				  </ul>
              </div>
			
			</td>
		</tr>
#end for

		</tbody>
			<tfoot>
				<tr>
					<th>Show name</th>
					<th>Season</th>
					<th>Episode</th>
					<th>Source</th>
					<th>Quality</th>
					<th>Codec</th>
					<th>Group</th>
					<th>Language</th>
					<th>Time</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
		</table>

#end if
		<br>
		</div>
#end if
		<hr>
	</div>
		
#set $lastdownload = lastDown().getlastDown()

#if $autosub.HOMELAYOUTFIRST == "Downloaded":
	<div id="Display1">
#else
	<div id="Display2">
#end if	
		<div class="well well-small center well-header"><b>Downloaded</b></div>
		<div class="well well-small center">
#if $len($lastdownload) == 0
		No data available at the moment.
#end if		
#if $len($lastdownload) >= 1
    
		<table id="downloaded">
			<thead>
				<tr>
					<th>Show name</th>
					<th>Season</th>
					<th>Episode</th>
					<th>Source</th>
					<th>Quality</th>
					<th>Codec</th>
					<th>Group</th>
					<th>Language</th>
					<th>Time</th>
				</tr>
			</thead>
			<tbody>
#for $var in $lastdownload
			<tr>
				<td align="left"><a data-placement="right" data-toggle="tooltip" data-original-title="$var['subtitle'].upper()">$var['show_name']</a></td>
				<td>$var['season']</td>
				<td>$var['episode']</td>
#if $type($var['source']) == UnicodeType:
				<td>$var['source'].upper()</td>
#else
				<td>Unknown</td>
#end if
#if $type($var['quality']) == UnicodeType:
				<td>$var['quality'].upper()</td>
#else
				<td>Unknown</td>
#end if
#if $type($var['codec']) == UnicodeType:
				<td>$var['codec'].upper()</td>
#else
				<td>Unknown</td>
#end if
#if $type($var['releasegrp']) == UnicodeType:
				<td>$var['releasegrp'].upper()</td>
#else
				<td>Unknown</td>
#end if
				<td>
					#set $imageurl = $autosub.WEBROOT + "/images/" + $var['language'] + ".png"
					<img src="$imageurl" alt="$var['language']" />
				</td>
#if $type($var['timestamp']) == UnicodeType:
				<td sorttable_customkey="$ConvertTimestampTable($var['timestamp'])">$ConvertTimestamp($var['timestamp'])</td>
#else
				<td>Unknown</td>
#end if
			</tr>	
#end for
			</tbody>
			<tfoot>
				<tr>
					<th>Show name</th>
					<th>Season</th>
					<th>Episode</th>
					<th>Source</th>
					<th>Quality</th>
					<th>Codec</th>
					<th>Group</th>
					<th>Language</th>
					<th>Time</th>
				</tr>
			</tfoot>
		</table>
#end if
		<br>
		</div>
	
		<hr>
	</div>
</div>		
		<div class="well well-small center well-header"><b>Next Run</b></div>
		<div class="well well-small center">
		
		<table class="table-nextrun">
			<tr>
				<td class="td-nextrun">ScanDisk</td>
				<td class="td-nextrun">CheckSub</td>
			</tr>
			<tr>
				<td class="td-nextrun">
					#try
					  $time.strftime('%H:%M:%S', $time.gmtime(($autosub.SCANDISK.interval - ($time.time() - $autosub.SCANDISK.lastrun) ))) <br>
					#except
					  Please wait...
					#end try
				</td>
				<td class="td-nextrun">
					#try
					  $time.strftime('%H:%M:%S', $time.gmtime(($autosub.CHECKSUB.interval - ($time.time() - $autosub.CHECKSUB.lastrun) ))) <br>
					#except
					  Please wait...
					#end try
				</td>
			</tr>
		</table>
		
		</div>
		
#include $os.path.join($autosub.PATH.encode(), "interface/templates/footer.tmpl")
